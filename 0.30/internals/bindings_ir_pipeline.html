
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Bindings IR Pipeline - The UniFFI user guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bindings-ir-pipeline" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="The UniFFI user guide" class="md-header__button md-logo" aria-label="The UniFFI user guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The UniFFI user guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bindings IR Pipeline
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mozilla/uniffi-rs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="The UniFFI user guide" class="md-nav__button md-logo" aria-label="The UniFFI user guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The UniFFI user guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mozilla/uniffi-rs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UniFFI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Motivation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Motivation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Getting_started.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/Prerequisites.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/udl_file.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Describing the interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/Rust_scaffolding.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rust scaffolding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/foreign_language_bindings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Foreign-language bindings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UniFFI type model
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            UniFFI type model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/namespace.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/builtin_types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Built-in types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/enumerations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enumerations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/records.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Records
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Functions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/functions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/errors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Throwing errors
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interfaces, Objects and Traits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/callback_interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Callback interfaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/remote_ext_types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote and External types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/custom_types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/defaults.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Default values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/uniffi_traits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exposing standard Rust traits
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Describing the interface
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Describing the interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../describing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Describing the interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UDL Files
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            UDL Files
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The UDL file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/enumerations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enums in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/errors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Errors in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/functions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interfaces in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/records.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Records in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/external_types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using types defined outside a UDL.
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/docstrings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Proc macros
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Proc macros
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Procedural Macros: Attributes and Derives
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/enumerations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enumerations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/errors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The uniffi::Error derive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/functions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions, Constructors, Methods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The uniffi::Object derive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/records.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The uniffi::Record derive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/renaming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Renaming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/docstrings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../futures.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Async/Future support
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bindings
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Bindings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bindings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generating bindings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../foreign_traits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Foreign traits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kotlin
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Kotlin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kotlin/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kotlin/gradle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrating with Gradle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kotlin/lifetimes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kotlin Lifetimes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Swift
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Swift
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Swift Bindings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/uniffi-bindgen-swift.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uniffi-bindgen-swift
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/module.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compiling a Swift module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/xcode.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrating with Xcode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    WASM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            WASM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wasm/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WASM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Internals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Internals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="design_principles.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Principles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="crates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Navigating the code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lifting_and_lowering.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lifting, Lowering and Serialization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ffi_converter_traits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ffi converter traits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rust_calls.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Foreign -&gt; Rust calls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="foreign_calls.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rust -&gt; Foreign calls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="object_references.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Managing Object References
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="async-overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UniFFI Async Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="async-ffi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UniFFI Async FFI details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rendering_foreign_bindings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rendering Foreign Bindings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Upgrading.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrading v0.28.x -&gt; v0.29.x
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node-conversions" class="md-nav__link">
    <span class="md-ellipsis">
      Node conversions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Node conversions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#field-conversion-order" class="md-nav__link">
    <span class="md-ellipsis">
      Field Conversion order
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#module-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Module structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-irs" class="md-nav__link">
    <span class="md-ellipsis">
      Defining IRs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constructing-nodes-with-partial-field-data" class="md-nav__link">
    <span class="md-ellipsis">
      Constructing nodes with partial field data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peeking-behind-the-curtains-with-the-pipeline-cli" class="md-nav__link">
    <span class="md-ellipsis">
      Peeking behind the curtains with the pipeline CLI
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="bindings-ir-pipeline">Bindings IR Pipeline</h1>
<p><strong>Note:</strong> the Bindings IR is currently an experiment.
It's checked in so that we can use it for the gecko-js external binding generator.
Our current recommendation for other external bindings authors is to avoid using it for now since we haven't fully committed to this new system and expect it to change.</p>
<p>The Bindings IR pipeline is used to transform different <a href="bindings_ir.html">intermediate representations of the generated bindings</a>.</p>
<ul>
<li>The foundational code lives in the <code>uniffi_pipeline</code> crate.
  This defines things like the <code>Node</code> trait.</li>
<li>The macro code lives in the <code>uniffi_internal_macros</code> crate.
  This defines things like the <code>Node</code> derive macro.</li>
<li><code>uniffi_bindgen</code> defines the general pipeline.
  This converts <code>uniffi_meta</code> metadata to the initial IR then converts that to the general IR.</li>
<li>Finally, each language defines their own pipeline, which extends the general pipeline and outputs a language-specific IR.</li>
</ul>
<h2 id="nodes">Nodes</h2>
<p>Types inside an IR are called "nodes" and they must derive a <code>Node</code> trait impl.
The top-level node is always named <code>Root</code>.
When this document talks about converting between two IRs, this means converting between the root nodes of those IRs.</p>
<p><code>Node</code> trait provides functionality to:</p>
<ul>
<li>Traverse the node tree.  <code>Node::visit()</code> and <code>Node::visit_mut()</code> allows you to visit all
  descendants with a given type.</li>
<li>Convert between any two nodes using <code>Node::try_from_node</code>.  This conversion is described in the
  next section.</li>
</ul>
<h2 id="node-conversions">Node conversions</h2>
<p><code>Node::try_from_node</code> attempts to convert a node from one IR to the corresponding node from another IR.
For example, <code>from_ir::Node</code> will be converted to <code>into_ir::Node</code> using the following rules:</p>
<ul>
<li>Any fields in <code>into_ir::Node</code>, but not <code>from_ir::Node</code> are added using <code>Default::default</code>, which the <code>Node</code> derive macro also derives.</li>
<li>Any fields in <code>from_ir::Node</code>, but not <code>into_ir::Node</code> are ignored</li>
<li>Any fields in both are recursively converted using <code>Node::try_from_node</code>.</li>
<li><code>try_from_node</code> is automatically derived using the <code>Node</code> derive macro.
  The conversion can be customized using macro attributes.</li>
</ul>
<p>Renamed node types, variants, and fields can be handled by adding the <code>#[node(from([name]))]</code> attribute:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#[derive(Node)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// `from_ir::Node::prev_name` fields become `into_ir::Node::new_name` fields.</span>
<span class="w">    </span><span class="cp">#[node(from(prev_name))]</span>
<span class="w">    </span><span class="n">new_name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>Also, nodes can be "wrapped" in the new IR using the <code>#[node(wraps([type]))]</code> attribute:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#[derive(Node)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// `into_ir::Node` wraps `from_ir::WrappedNode`.</span>
<span class="w">    </span><span class="sd">/// All `from_ir::WrappedNode` values will be replaced with `Node { wrapped: wrapped_node }` values.</span>
<span class="w">    </span><span class="sd">/// Any other fields will be initialized to their default values.</span>
<span class="w">    </span><span class="sd">///</span>
<span class="w">    </span><span class="sd">/// This is mostly used as a way to add fields to enum types.</span>
<span class="w">    </span><span class="sd">/// Wrap the enum with a struct, then add fields to that struct.</span>
<span class="w">    </span><span class="sd">/// For example, `TypeNode` wraps the `Type` enum from `uniffi_meta`.</span>
<span class="w">    </span><span class="cp">#[node(wraps)]</span>
<span class="w">    </span><span class="n">wrapped</span><span class="p">:</span><span class="w"> </span><span class="nc">WrappedNode</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-conversion-order">Field Conversion order</h3>
<p>Fields are converted in declaration order.
This matters when a field is listed twice with one of them using <code>#[node(from(&lt;name_of_the_other_field&gt;)]</code>.
In this case the first field declared will be initialized with the data from the previous pass and the second field will be initialized to the default value.</p>
<p>You can take advantage of this to convert an optional value into a non-optional value.
For example:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#[derive(Node)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">SourceNode</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="cp">#[derive(Node)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">DestNode</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// This field will be set to `SourceNode::name`</span>
<span class="w">    </span><span class="cp">#[node(from(name))]</span>
<span class="w">    </span><span class="n">name_from_previous_pass</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span>
<span class="w">    </span><span class="sd">/// This field will be a non-optional version of `SourceNode::name`.</span>
<span class="w">    </span><span class="sd">/// It will be initialized to an empty string, then a pipeline pass will populate it using</span>
<span class="w">    </span><span class="sd">/// `name_from_previous_pass` combined with logic to handle the `None` case.</span>
<span class="w">    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="module-structure">Module structure</h2>
<p>Each IRs will typically have a module dedicated to them with the following structure:</p>
<ul>
<li><code>mod.rs</code> -- Top-level module.  This is where the pipeline for the IR is defined.</li>
<li><code>nodes.rs</code> -- Node definitions.</li>
<li><em>other submodules</em> -- Define pipeline pass functions.  These are named <code>pass()</code> by convention.</li>
</ul>
<h2 id="defining-irs">Defining IRs</h2>
<ul>
<li>Start with an existing IR, let's assume it lives in the <code>from_ir</code> module.</li>
<li>Define a new module for your IR, let's call it <code>into_ir</code></li>
<li>Copy the <code>from_ir/nodes.rs</code> to <code>into_ir/nodes.rs</code></li>
<li>Add new fields to the structs in <code>into_ir::nodes</code></li>
<li>Define pipeline passes to populate the new fields, using the existing fields.  For example, <code>into_ir/mod.rs</code> might define a pipeline like this:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// The output type is a pipeline that converts from `initial::Root` to the `Root` node from this IR.</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">pipeline</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Pipeline</span><span class="o">&lt;</span><span class="n">initial</span><span class="p">::</span><span class="n">Root</span><span class="p">,</span><span class="w"> </span><span class="n">Root</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Start with `from_ir&#39;s` pipeline.  This converts `initial::root` to `from_ir::Root`.</span>
<span class="w">    </span><span class="n">from_ir</span><span class="p">::</span><span class="n">pipeline</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Convert to `into_ir::Root`.</span>
<span class="w">        </span><span class="c1">// This will use the logic from the Node conversions section above.</span>
<span class="w">        </span><span class="p">.</span><span class="n">convert_ir_pass</span><span class="p">::</span><span class="o">&lt;</span><span class="n">Root</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Add passes to populate the new fields, mutate existing fields, etc.</span>
<span class="w">        </span><span class="p">.</span><span class="n">pass</span><span class="p">(</span><span class="n">foo</span><span class="p">::</span><span class="n">pass</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">pass</span><span class="p">(</span><span class="n">bar</span><span class="p">::</span><span class="n">pass</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">pass</span><span class="p">(</span><span class="n">baz</span><span class="p">::</span><span class="n">pass</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Define the pipeline passes.
  These input a node type in the IR and mutate all instances of that node.
  <code>visit()</code> and <code>visit_mut()</code> are extremely helpful here.
  For example, the general IR pass that adds FFI types to types looks like this:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Visiting all `Module` nodes</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">pass</span><span class="p">(</span><span class="n">module</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Module</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Save a copy of the module name, then visit all `TypeNode` nodes.</span>
<span class="w">    </span><span class="c1">// Note: TypeNode wraps the `Type` enum from the initial IR</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">module_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Visit all `TypeNode` instances that are descendants of `Module`.</span>
<span class="w">    </span><span class="n">module</span><span class="p">.</span><span class="n">visit_mut</span><span class="p">(</span><span class="o">|</span><span class="n">node</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">TypeNode</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Derive the FfiType from the type and module name</span>
<span class="w">        </span><span class="n">node</span><span class="p">.</span><span class="n">ffi_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generate_ffi_type</span><span class="p">(</span><span class="o">&amp;</span><span class="n">node</span><span class="p">.</span><span class="n">ty</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">module_name</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<p>See <code>uniffi_bindgen::pipeline::general</code> for examples.</p>
<h2 id="constructing-nodes-with-partial-field-data">Constructing nodes with partial field data</h2>
<p>Passes that construct new nodes often only want to specify partial field data and let a later pass populate the rest of the fields.
Use the <code>Default::default()</code> to handle this case, which the <code>Node</code> derive also implements.
Here's how this works in the <code>callables</code> pass:</p>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">pass</span><span class="p">(</span><span class="n">root</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Root</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">root</span><span class="p">.</span><span class="n">visit_mut</span><span class="p">(</span><span class="o">|</span><span class="n">func</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Function</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">func</span><span class="p">.</span><span class="n">callable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Callable</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Most of the fields are simply copied from `Function`</span>
<span class="w">            </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span>
<span class="w">            </span><span class="n">is_async</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">.</span><span class="n">is_async</span><span class="p">,</span>
<span class="w">            </span><span class="n">kind</span><span class="p">:</span><span class="w"> </span><span class="nc">CallableKind</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span>
<span class="w">            </span><span class="n">arguments</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">.</span><span class="n">inputs</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span>
<span class="w">            </span><span class="n">return_type</span><span class="p">:</span><span class="w"> </span><span class="nc">ReturnType</span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">ty</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">.</span><span class="n">return_type</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">ty</span><span class="o">|</span><span class="w"> </span><span class="n">TypeNode</span><span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="p">}),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">throws_type</span><span class="p">:</span><span class="w"> </span><span class="nc">ThrowsType</span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">ty</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">.</span><span class="n">throws</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">ty</span><span class="o">|</span><span class="w"> </span><span class="n">TypeNode</span><span class="o">!</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="p">}),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="n">checksum</span><span class="p">:</span><span class="w"> </span><span class="nc">func</span><span class="p">.</span><span class="n">checksum</span><span class="p">,</span>
<span class="w">            </span><span class="c1">// However, `async_data` and `ffi_func` are derived in a later pass.</span>
<span class="w">            </span><span class="c1">// Use `default()` to create placeholder values for now</span>
<span class="w">            </span><span class="o">..</span><span class="n">Callable</span><span class="p">::</span><span class="n">default</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="c1">// ... repeat for methods and constructors</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="peeking-behind-the-curtains-with-the-pipeline-cli">Peeking behind the curtains with the <code>pipeline</code> CLI</h2>
<p>Use the <code>pipeline</code> subcommand from any UniFFI CLI to inspect IR data at various stages of the pipeline.</p>
<ul>
<li>Build a UniFFI crate that you'd like to inspect, for example <code>cargo build -p uniffi-example-arithmetic</code></li>
<li>Run the <a href="../tutorial/foreign_language_bindings.html">uniffi-bindgen CLI</a>, with these arguments <code>pipeline --library path/to/library.so_a_or_dll [language]</code></li>
<li>For example, in the UniFFI repo, <code>cargo run -p uniffi-bindgen-cli -- pipeline --library target/debug/libarithmetical.so python</code></li>
</ul>
<p>This will print out:</p>
<ul>
<li>The initial IR</li>
<li>The diff after each pass</li>
<li>The final IR</li>
</ul>
<p>This is a lot of data.  Use CLI flags to reduce it to a reasonable amount:</p>
<ul>
<li><code>-p</code>, <code>--pass</code> only show a single pass.</li>
<li>Use <code>-p final</code> to only show the final pass in the process, which can be usefull when you're adding pass functions and want to see their effects.</li>
<li><code>-t</code>, <code>--type</code> to only show one node type (e.g. <code>-t Record</code> or <code>-t Interface</code>).</li>
<li><code>-n</code>, <code>--name</code> to only show with nodes with a specific name</li>
</ul>
<p>Alternatively, if you want to see the full IR for each pass, you can use <code>--no-diff</code> to print it out.
Piping to a pager like <code>less</code> is highly recommended in this case.</p>
<p>You can test this out yourself by running the following command to follow the <code>add</code> function as it moves through the IR pipeline:</p>
<p><code>cargo run -p uniffi-bindgen-cli -- pipeline --library target/debug/libarithmetical.so python -t Function -n add | less</code></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>