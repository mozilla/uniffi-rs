
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="rendering_foreign_bindings.html">
      
      
        <link rel="next" href="bindings_ir_pipeline.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>The UniFFI Bindings IR - The UniFFI user guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-uniffi-bindings-ir" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="The UniFFI user guide" class="md-header__button md-logo" aria-label="The UniFFI user guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The UniFFI user guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              The UniFFI Bindings IR
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mozilla/uniffi-rs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="The UniFFI user guide" class="md-nav__button md-logo" aria-label="The UniFFI user guide" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The UniFFI user guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mozilla/uniffi-rs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UniFFI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Motivation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Motivation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Getting_started.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/Prerequisites.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/udl_file.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Describing the interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/Rust_scaffolding.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rust scaffolding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/foreign_language_bindings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Foreign-language bindings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UniFFI type model
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            UniFFI type model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/namespace.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/builtin_types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Built-in types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/enumerations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enumerations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/records.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Records
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Functions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/functions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/errors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Throwing errors
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interfaces, Objects and Traits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/callback_interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Callback interfaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/remote_ext_types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote and External types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/custom_types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/defaults.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Default values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/uniffi_traits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exposing standard Rust traits
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Describing the interface
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Describing the interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../describing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Describing the interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UDL Files
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            UDL Files
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The UDL file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/enumerations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enums in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/errors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Errors in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/functions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interfaces in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/records.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Records in UDL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/external_types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using types defined outside a UDL.
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udl/docstrings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Proc macros
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Proc macros
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Procedural Macros: Attributes and Derives
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/enumerations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enumerations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/errors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The uniffi::Error derive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/functions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions, Constructors, Methods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The uniffi::Object derive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/records.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The uniffi::Record derive
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/renaming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Renaming via proc-macros
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proc_macro/docstrings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../renaming.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Renaming
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../futures.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Async/Future support
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bindings
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Bindings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bindings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generating bindings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../foreign_traits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Foreign traits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kotlin
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Kotlin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kotlin/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kotlin/gradle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrating with Gradle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kotlin/lifetimes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kotlin Lifetimes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Swift
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Swift
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Swift Bindings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/uniffi-bindgen-swift.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    uniffi-bindgen-swift
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/module.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compiling a Swift module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../swift/xcode.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrating with Xcode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    WASM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            WASM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wasm/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WASM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Internals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Internals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="design_principles.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Principles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="crates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Navigating the code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UniFFI Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lifting_and_lowering.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lifting, Lowering and Serialization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ffi_converter_traits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ffi converter traits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rust_calls.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Foreign -&gt; Rust calls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="foreign_calls.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rust -&gt; Foreign calls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="object_references.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Managing Object References
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="async-overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UniFFI Async Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="async-ffi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UniFFI Async FFI details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rendering_foreign_bindings.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rendering Foreign Bindings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    The UniFFI Bindings IR
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="bindings_ir.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    The UniFFI Bindings IR
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#generation" class="md-nav__link">
    <span class="md-ellipsis">
      Generation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-initial-ir" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata -&gt; Initial IR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initial-ir-general-ir" class="md-nav__link">
    <span class="md-ellipsis">
      Initial IR -&gt; General IR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-ir-language-specific-ir" class="md-nav__link">
    <span class="md-ellipsis">
      General IR -&gt; Language-specific IR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#language-specific-ir-generated-bindings-code" class="md-nav__link">
    <span class="md-ellipsis">
      Language-specific IR -&gt; Generated Bindings Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-this-work-under-the-hood" class="md-nav__link">
    <span class="md-ellipsis">
      How does this work under the hood?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="bindings_ir_pipeline.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bindings IR Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Upgrading.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrading v0.28.x -&gt; v0.29.x
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#generation" class="md-nav__link">
    <span class="md-ellipsis">
      Generation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-initial-ir" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata -&gt; Initial IR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initial-ir-general-ir" class="md-nav__link">
    <span class="md-ellipsis">
      Initial IR -&gt; General IR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-ir-language-specific-ir" class="md-nav__link">
    <span class="md-ellipsis">
      General IR -&gt; Language-specific IR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#language-specific-ir-generated-bindings-code" class="md-nav__link">
    <span class="md-ellipsis">
      Language-specific IR -&gt; Generated Bindings Code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-this-work-under-the-hood" class="md-nav__link">
    <span class="md-ellipsis">
      How does this work under the hood?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="the-uniffi-bindings-ir">The UniFFI Bindings IR</h1>
<p><strong>Note:</strong> the Bindings IR is currently an experiment.
It's checked in so that we can use it for the gecko-js external binding generator.
Our current recommendation for other external bindings authors is to avoid using it for now since we haven't fully committed to this new system and expect it to change.</p>
<p>UniFFI models foreign bindings generation as a compiler pipeline:</p>
<pre class="mermaid"><code>flowchart LR
    ProcMacros[Rust + proc-macros] --&gt; Metadata[Metadata]
    UDL[UDL] --&gt; Metadata[Metadata]
    Metadata --&gt; InitialIr[Initial IR]
    InitialIr --&gt; GeneralIr[General IR]
    GeneralIr --&gt; KotlinIr[Kotlin IR]
    GeneralIr --&gt; SwiftIr[Swift IR]
    GeneralIr --&gt; PythonIr[Python IR]
    GeneralIr --&gt; RubyIr[Ruby IR]

    subgraph Not yet implemented
    KotlinIr --&gt; Kotlin[Generated Kotlin]
    SwiftIr --&gt; Swift[Generated Swift]
    PythonIr --&gt; Python[Generated Python]
    RubyIr --&gt; Ruby[Generated Ruby]
    end</code></pre>
<ol>
<li>Metadata is generated from the proc-macro code and UDL files.
   The metadata is a simple reflection of the Rust definitions.</li>
<li>The initial IR is built from the metadata with very few transformations.</li>
<li>The initial IR is transformed into the general IR.
   This adds information like FFI function names, that's needed for bindings generation.</li>
<li>The general IR is transformed into a language-specific IR.
   This adds information like concrete type names.</li>
<li>The final step uses the language-specific IR and to generate the bindings code.</li>
</ol>
<p>This document describes the system from a high-level.
See <a href="bindings_ir_pipeline.html">Bindings IR Pipeline</a> for details on how the IR pipeline is implemented.</p>
<h2 id="generation">Generation</h2>
<p>When a UniFFI proc-macro wraps a Rust item, it records metadata about the item it's wrapping.
For example, when <code>#[uniffi::export]</code> wraps a function, it records the function name, arguments, return type, etc.
This metadata is then serialized into a buffer and stored as an exported symbol in the Rust library.
The generated code will look something like this:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// An example exported Rust function</span>
<span class="cp">#[uniffi::export]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="kt">u64</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">checked_add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">ok_or</span><span class="p">(</span><span class="n">ArithmeticError</span><span class="p">::</span><span class="n">IntegerOverflow</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// Metadata buffer for `arithmetic::add()`, generated by the `uniffi::export` macro.</span>
<span class="k">const</span><span class="w"> </span><span class="n">UNIFFI_META_CONST_ARITHMETIC_FUNC_ADD</span><span class="p">:</span><span class="w"> </span><span class="p">::</span><span class="n">uniffi</span><span class="p">::</span><span class="n">MetadataBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">::</span><span class="n">uniffi</span><span class="p">::</span><span class="n">MetadataBuffer</span><span class="p">::</span><span class="n">from_code</span><span class="p">(</span>
<span class="w">        </span><span class="p">::</span><span class="n">uniffi</span><span class="p">::</span><span class="n">metadata</span><span class="p">::</span><span class="n">codes</span><span class="p">::</span><span class="n">FUNC</span><span class="p">,</span><span class="w"> </span><span class="c1">// Code for the item type</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat_str</span><span class="p">(</span><span class="s">&quot;arithmetic&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// module name</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat_str</span><span class="p">(</span><span class="s">&quot;add&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// function name</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat_bool</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="c1">// async?</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat_value</span><span class="p">(</span><span class="mi">2</span><span class="k">u8</span><span class="p">)</span><span class="w"> </span><span class="c1">// number of arguments</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat_str</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 1st argument name</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="o">&lt;</span><span class="kt">u64</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">::</span><span class="n">uniffi</span><span class="p">::</span><span class="n">TypeId</span><span class="o">&lt;</span><span class="k">crate</span><span class="p">::</span><span class="n">UniFfiTag</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">TYPE_ID_META</span><span class="p">)</span><span class="w"> </span><span class="c1">// 1st argument type</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat_bool</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="c1">// default value?</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat_str</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 2nd argument name</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="o">&lt;</span><span class="kt">u64</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">::</span><span class="n">uniffi</span><span class="p">::</span><span class="n">TypeId</span><span class="o">&lt;</span><span class="k">crate</span><span class="p">::</span><span class="n">UniFfiTag</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">TYPE_ID_META</span><span class="p">)</span><span class="w"> </span><span class="c1">// 2nd argument type</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat_bool</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="c1">// default value?</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="kt">u64</span><span class="o">&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">::</span><span class="n">uniffi</span><span class="p">::</span><span class="n">TypeId</span><span class="o">&lt;</span><span class="k">crate</span><span class="p">::</span><span class="n">UniFfiTag</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">TYPE_ID_META</span><span class="p">)</span><span class="w"> </span><span class="c1">// result type</span>
<span class="w">    </span><span class="p">.</span><span class="n">concat_long_str</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// docstring</span>

<span class="c1">// Serialize the metadata into a byte array and export the symbol.</span>
<span class="c1">// This can be evaluated at compile time because `UNIFFI_META_ARITHMETIC_FUNC_ADD` is `const`.</span>
<span class="cp">#[no_mangle]</span>
<span class="cp">#[doc(hidden)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">UNIFFI_META_ARITHMETIC_FUNC_ADD</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="n">UNIFFI_META_CONST_ARITHMETIC_FUNC_ADD</span>
<span class="w">    </span><span class="p">.</span><span class="n">size</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UNIFFI_META_CONST_ARITHMETIC_FUNC_ADD</span><span class="p">.</span><span class="n">into_array</span><span class="p">();</span>
</code></pre></div>
<p>Notes:</p>
<ul>
<li>UniFFI gets the type metadata types using the <code>TypeId::TYPE_ID_META</code>.
  By using a trait and associated type rather than relying on the type identifier, we get the correct metadata even through type aliases.
  For example, <code>Result&lt;u64&gt;</code> is a type alias with the error type omitted, but <code>&lt;Result&lt;u64&gt; as ::uniffi::TypeId&lt;crate::UniFfiTag&gt;&gt;::TYPE_ID_META&gt;</code> includes metadata about the error type.</li>
<li>See <a href="lifting_and_lowering.html">Lifting and Lowering</a> for details on <code>UniFfiTag</code>.</li>
<li>If a UDL file is present, UniFFI also generates metadata from that and merges it with the proc-macro metadata.</li>
</ul>
<p>When a UniFFI bindgen command runs, it reads/deserializes the exported metadata symbols from the Rust library.
Then the metadata is passed on to the next stage of the pipeline
See <code>uniffi_bingen::macro_metadata</code> and <code>uniffi_meta::reader</code> for details.</p>
<p>Here's how the metadata might look for the above function:
<div class="highlight"><pre><span></span><code>FnMetadata {
    module_path: &quot;arithmetic&quot;,
    name: &quot;add&quot;,
    is_async: false,
    inputs: [
        FnParamMetadata {
            name: &quot;a&quot;,
            ty: UInt64,
            by_ref: false,
            optional: false,
            default: None,
        },
        FnParamMetadata {
            name: &quot;b&quot;,
            ty: UInt64,
            by_ref: false,
            optional: false,
            default: None,
        },
    ],
    return_type: Some(
        UInt64,
    ),
    throws: Some(
        Enum {
            module_path: &quot;arithmetic&quot;,
            name: &quot;ArithmeticError&quot;,
        },
    ),
    checksum: Some(
        39863,
    ),
    docstring: None,
},
</code></pre></div></p>
<h2 id="metadata-initial-ir">Metadata -&gt; Initial IR</h2>
<p>This phase transforms inputs the metadata and creates an IR from it.
The Initial IR contains the metadata items with a couple changes.
The main change is the flat list is converted into a tree structure.</p>
<div class="highlight"><pre><span></span><code><span class="sd">/// Root node of the Initial IR</span>
<span class="sd">///</span>
<span class="sd">/// Note: The `Node` derive also implements `Default` and `Default` should not be listed in the</span>
<span class="sd">/// #[derive] list.</span>
<span class="cp">#[derive(Debug, Clone, Node)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Root</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">modules</span><span class="p">:</span><span class="w"> </span><span class="nc">IndexMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">Module</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="sd">/// The library path the user passed to us, if we&#39;re in library mode</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">cdylib</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="cp">#[derive(Debug, Clone, Node)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Module</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">crate_name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">docstring</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">functions</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Function</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">type_definitions</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">TypeDefinition</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="cp">#[derive(Debug, Clone, Node)]</span>
<span class="c1">// This is just FnMetadata with a new struct name</span>
<span class="cp">#[node(from(FnMetadata))]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Function</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">is_async</span><span class="p">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">inputs</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Argument</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">return_type</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Type</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">throws</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Type</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">checksum</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="kt">u16</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">docstring</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="cp">#[derive(Debug, Clone, Node)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">TypeDefinition</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="sd">/// RecordMetadata with a new struct name</span>
<span class="w">    </span><span class="sd">/// This has `FieldMetadata` as child nodes</span>
<span class="w">    </span><span class="n">Record</span><span class="p">(</span><span class="n">Record</span><span class="p">),</span>
<span class="w">    </span><span class="sd">/// RecordMetadata with a new struct name</span>
<span class="w">    </span><span class="sd">/// This has `VariantMetadata` as child nodes and `FieldMetadata` as grand children.</span>
<span class="w">    </span><span class="n">Enum</span><span class="p">(</span><span class="n">Enum</span><span class="p">),</span>
<span class="w">    </span><span class="sd">/// ObjectMetadata with a new struct name</span>
<span class="w">    </span><span class="sd">/// This has child nodes for ConstructorMetadata, MethodMetadata, and several other metadata</span>
<span class="w">    </span><span class="sd">/// items.</span>
<span class="w">    </span><span class="n">Interface</span><span class="p">(</span><span class="n">Interface</span><span class="p">),</span>
<span class="w">    </span><span class="sd">/// ...etc</span>
<span class="w">    </span><span class="n">CallbackInterface</span><span class="p">(</span><span class="n">CallbackInterface</span><span class="p">),</span>
<span class="w">    </span><span class="n">Custom</span><span class="p">(</span><span class="n">CustomType</span><span class="p">),</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="initial-ir-general-ir">Initial IR -&gt; General IR</h2>
<p>This phase adds derived information about the FFI.
Some examples are:</p>
<ul>
<li>The FFI scaffolding function for each Rust function</li>
<li>The FFI scaffolding functions to clone/free object references</li>
<li>The FFI type that each type is lowered into/lifted from</li>
<li>If a type is used as an error or not</li>
</ul>
<p>Here's how <code>Function</code> might look in the General IR.</p>
<div class="highlight"><pre><span></span><code>Function {
    name: &quot;add&quot;,
    ...
    arguments: [
        Argument {
            name: &quot;a&quot;,
            ty: Type {
                kind: UInt64,
                ffi_type: FfiType::UInt64,
                ...
            },
            ...
        },
        ...
    ],
    return_type: ReturnType {
        ty: Some(
            Type {
                kind: UInt64,
                ffi_type: FfiType::UInt64,
                ...
            },
        ),
        ...
    },
    throws_type: ThrowsType {
        ty: Some(
            Type {
                kind: Enum {
                    module_path: &quot;arithmeticpm&quot;,
                    name: &quot;ArithmeticError&quot;,
                },
                ffi_type: FfiType::RustBuffer,
                ...
            },
        ),
        ...
    },
    ffi_func: FfiFunctionRef {
        name: &quot;uniffi_arithmeticpm_fn_func_add&quot;,
        ...
    },
    ...
}
</code></pre></div>
<h2 id="general-ir-language-specific-ir">General IR -&gt; Language-specific IR</h2>
<p>This phase transforms the general IR into a language-specific one:</p>
<ul>
<li>Language-specific data is added, like concrete type names and the names of the <code>FfiConverter</code> classes that lift/lower types</li>
<li>New top-level items may be added, for example a list of import statements.</li>
<li>Fields like <code>name</code> and <code>docstring</code> will be transformed to the preferred style for the language.</li>
</ul>
<p>For example, when the function IR is specialized for Python:</p>
<ul>
<li>Concrete type names will be added</li>
<li>The FFI converter class name is added</li>
<li>Docstrings will be formatted as Python docstrings</li>
<li>Names will usually stay the same, since Rust and Python happen to share the same naming style.
  Other languages may translate names into camelCase.</li>
</ul>
<div class="highlight"><pre><span></span><code>Function {
    name: &quot;add&quot;,
    ...
    arguments: [
        Argument {
            name: &quot;a&quot;,
            ty: Type {
                kind: UInt64,
                &quot;type_name&quot;: String(
                    &quot;int&quot;,
                ),
                &quot;ffi_converter_name&quot;: String(
                    &quot;_UniffiConverterUInt64&quot;,
                ),
                &quot;ffi_type_name&quot;: String(
                    &quot;ctypes.c_uint64&quot;,
                ),
                ...
            },
            ...
        },
        ...
    ],
    return_type: ReturnType {
        ty: Some(
            Type {
                kind: UInt64,
                &quot;type_name&quot;: String(
                    &quot;int&quot;,
                ),
                &quot;ffi_converter_name&quot;: String(
                    &quot;_UniffiConverterUInt64&quot;,
                ),
                &quot;ffi_type_name&quot;: String(
                    &quot;ctypes.c_uint64&quot;,
                ),
                ...
            },
        ),
        ...
    },
    throws_type: ThrowsType {
        ty: Some(
            Type {
                kind: Enum {
                    module_path: &quot;arithmeticpm&quot;,
                    name: &quot;ArithmeticError&quot;,
                },
                &quot;type_name&quot;: String(
                    &quot;ArithmeticError&quot;,
                ),
                &quot;ffi_converter_name&quot;: String(
                    &quot;_UniffiConverterTypeArithmeticError&quot;,
                ),
                &quot;ffi_type_name&quot;: String(
                    &quot;_UniffiRustBuffer&quot;,
                ),
                ...
            },
        ),
        ...
    },
    ffi_func: FfiFunctionRef {
        name: &quot;uniffi_arithmeticpm_fn_func_add&quot;,
        ...
    },
    ...
},
</code></pre></div>
<h2 id="language-specific-ir-generated-bindings-code">Language-specific IR -&gt; Generated Bindings Code</h2>
<p>The final phase takes the language-specific IR and uses it to generate the bindings code.
We use the <a href="https://askama.readthedocs.io/en/stable/">Askama</a> template rendering engine for this.</p>
<p>In this phase, the top-level <code>add</code> function is implemented by:</p>
<ul>
<li>checking/lowering all arguments using the class named by <code>Argument.ty.lang_data.ffi_converter_name</code></li>
<li>calling the scaffolding function named by <code>ffi_func.name</code></li>
<li>handling errors using the class named by <code>ReturnType.ty.lang_dataffi_converter_name</code></li>
<li>lifting the return value using the class named by <code>ThrowsType.ty.lang_data.ffi_converter_name</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">_UniffiConverterUInt64</span><span class="o">.</span><span class="n">check_lower</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">_UniffiConverterUInt64</span><span class="o">.</span><span class="n">check_lower</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">_uniffi_return</span> <span class="o">=</span> <span class="n">_uniffi_rust_call_with_error</span><span class="p">(</span>
        <span class="n">_UniffiConverterTypeArithmeticError</span><span class="p">,</span>
        <span class="n">_UniffiLib</span><span class="o">.</span><span class="n">uniffi_arithmeticpm_fn_func_add</span><span class="p">,</span>
        <span class="n">_UniffiConverterUInt64</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="n">_UniffiConverterUInt64</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">_UniffiConverterUInt64</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="n">_uniffi_return</span><span class="p">)</span>
</code></pre></div>
<h2 id="how-does-this-work-under-the-hood">How does this work under the hood?</h2>
<p>See <a href="bindings_ir_pipeline.html">Bindings IR Pipeline</a> for details on how the IR pipeline is implemented.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>